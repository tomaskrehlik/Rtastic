      <h1>Finding Univariate or Multivariate Power Transformations</h1>

<div class="row">
  <div class="span8">
    <h2>Usage</h2>
    <pre><span class="functioncall"><a href='powerTransform.html'>powerTransform</a></span><span class="keyword">(</span><span class="symbol">object</span><span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">)</span>

<span class="functioncall"><a href='powerTransform.html'>powerTransform</a></span><span class="keyword">(</span><span class="symbol">object</span><span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">)</span>

<span class="functioncall"><a href='powerTransform.html'>powerTransform</a></span><span class="keyword">(</span><span class="symbol">object</span><span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">)</span>

<span class="functioncall"><a href='powerTransform.html'>powerTransform</a></span><span class="keyword">(</span><span class="symbol">object</span><span class="keyword">,</span> <span class="symbol">data</span><span class="keyword">,</span> <span class="symbol">subset</span><span class="keyword">,</span> <span class="symbol">weights</span><span class="keyword">,</span> <span class="symbol">na.action</span><span class="keyword">,</span> <span class="symbol">...</span><span class="keyword">)</span></pre>
    
    <h2>Arguments</h2>
    <dl>
      <dt>object</dt>
      <dd>This can either be an object of class
  <code>lm</code>, a formula, or a matrix or vector; see below.</dd>
      <dt>data</dt>
      <dd>A data frame or environment, as in <code><a href='http://www.inside-r.org/r-doc/stats/lm'>lm</a></code>.</dd>
      <dt>subset</dt>
      <dd>Case indices to be used, as in <code><a href='http://www.inside-r.org/r-doc/stats/lm'>lm</a></code>.</dd>
      <dt>weights</dt>
      <dd>Weights as in <code><a href='http://www.inside-r.org/r-doc/stats/lm'>lm</a></code>.</dd>
      <dt>na.action</dt>
      <dd>Missing value action, as in &#145;lm&#146;.</dd>
      <dt>...</dt>
      <dd>Additional arguments that are passed to <code><a href='estimateTransform.html'>estimateTransform</a></code>,
  which does the actual computing, or the <code><a href='http://www.inside-r.org/r-doc/stats/optim'>optim</a></code> 
  function, which does the maximization.  See the documentation for these functions
  for the arguments that are permitted, including <code>family</code> for
  setting the power transformation family.</dd>
    </dl>
    
    <div class="Description">
      <h2>Description</h2>
      
      <p><code>powerTransform</code> computes members of families of transformations indexed by one
parameter, the Box-Cox power family, or the Yeo and Johnson (2000) family, or the
basic power family, interpreting zero power as logarithmic. 
The family can be modified to have Jacobian one, or not, except for the basic
power family.</p>
  
    </div>

    <div class="Details">
      <h2>Details</h2>
      
      <p>The function powerTransform is used to estimate normalizing transformations
of a univariate or a multivariate random variable.  For a univariate transformation,
a formula like <code>z~x1+x2+x3</code> will find estimate a transformation for the response
<code>z</code> from the family of transformations indexed by the parameter <code>lambda</code>
that makes the residuals from the regression of the transformed <code>z</code> on the predictors
as closed to normally distributed as possible.  This generalizes the Box and
Cox (1964) transformations to normality only by allowing for families other than the
power transformations used in that paper.</p>
  
      <p>For a formula like <code>cbind(y1,y2,y3)~x1+x2+x3</code>, the three variables on
the left-side are all transformed, generally with different transformations
to make all the residuals as close to
normally distributed as possible.  <code>cbind(y1,y2,y3)~1</code> would specify transformations
to multivariate normality with no predictors.  This generalizes the multivariate
power transformations suggested by Velilla (1993) by allowing for different
families of transformations, and by allowing for predictors.  Cook and Weisberg (1999)
and Weisberg (2005) suggest the usefulness of transforming
a set of predictors <code>z1, z2, z3</code> for multivariate normality and for transforming
for multivariate normality conditional on levels of a factor, which is equivalent
to setting the predictors to be indicator variables for that factor.</p>
  
      <p>Specifying the first argument as a vector, for example
<code>powerTransform(ais$LBM)</code>, is equivalent to
<code>powerTransform(LBM ~ 1, ais)</code>.  Similarly,
<code>powerTransform( cbind(ais$LBM, ais$SSF))</code>, where the first argument is a matrix
rather than a formula is equivalent to
<code>powerTransform(cbind(LBM, SSF) ~ 1, ais)</code>.</p>
  
      <p>Two families of power transformations are available.
The bcPower family of <em>scaled power transformations</em>,
<code>family="bctrans"</code>, 
equals <code class = 'eq'>(U^(lambda)-1)/lambda</code> 
for <code class = 'eq'>lambda</code> <code class = 'eq'>not equal to</code> 0, and 
<code class = 'eq'>log(U)</code> if <code class = 'eq'>lambda = 0</code>.</p>
  
      <p>If <code>family="yjPower"</code> then the Yeo-Johnson transformations are used.  
This is is Box-Cox transformation of <code class = 'eq'>U+1</code> for nonnegative values, 
and of <code class = 'eq'>|U|+1</code> with parameter <code class = 'eq'>2-lambda</code> for <code class = 'eq'>U</code>
negative.</p>
  
      <p>Other families can be added by writing a function whose first argument is a
matrix or vector to be transformed, and whose second argument is the value of the
transformation parameter.  The function must return modified transformations
so that the Jacobian of the transformation is equal to one; see Cook and
Weisberg
(1982).</p>
  
      <p>The function <code>powerTransform</code> is a front-end for
<code><a href='estimateTransform.html'>estimateTransform</a></code>.</p>
  
      <p>The function <code><a href='testTransform.html'>testTransform</a></code> is used to obtain likelihood ratio
tests for
any specified value for the transformation parameters.  It is used by the
summary method for powerTransform objects.</p>
  
      <p></p>
  
    </div>

    <div class="Value">
      <h2>Value</h2>
      
      <p>The result of <code>powerTransform</code> is an object of class <code>powerTransform</code>
that gives the estimates of the the transformation parameters and related 
statistics.  The <code>print</code> method for the object will display the estimates only;
the <code>summary</code> method provides both the estimates, standard errors, marginal Wald
confidence intervals and relevant likelihood ratio tests.</p>
  
      <p>Several helper functions are available.  The <code>coef</code> method returns 
the estimated transformation parameters, while <code>coef(object,round=TRUE)</code>
will
return the transformations rounded to nearby convenient values within 1.96
standard errors of the mle.
The <code>vcov</code> function returns the estimated covariance matrix of the
estimated
transformation parameters.  A <code>print</code> method is used to
print the objects and <code>summary</code> to provide more information.  By default
the summary method calls <code>testTransform</code> and provides likelihood ratio type
tests that all transformation parameters equal one and that all transformation
parameters equal zero, for log transformations, and for a convenient rounded value
not far from the mle.  The function can be called
directly to test any other value for <code class = 'eq'>lambda</code>.</p>
  
    </div>

    <div class="References">
      <h2>References</h2>
      
      <p>Box, G. E. P. and Cox, D. R. (1964) An analysis of transformations.
<em>Journal
of the Royal Statisistical Society, Series B</em>. 26 211-46.</p>
  
      <p>Cook, R. D. and Weisberg, S. (1999)  <em>Applied Regression Including
Computing
and Graphics</em>.  Wiley.</p>
  
      <p>Fox, J. and Weisberg, S. (2011) 
<em>An R Companion to Applied Regression</em>, Second Edition, Sage.</p>
  
      <p>Velilla, S. (1993)  A note on the multivariate Box-Cox transformation to 
normality.  <em>Statistics and Probability Letters</em>, 17, 259-263.</p>
  
      <p>Weisberg, S. (2005) <em>Applied Linear Regression</em>, Third Edition. Wiley.</p>
  
      <p>Yeo, I. and Johnson, R. (2000) A new family of
power transformations to improve normality or symmetry.  
<em>Biometrika</em>, 87, 954-959.</p>
  
    </div>

    <div class="Finding Univariate or Multivariate Power Transformations">
      <h2>Finding Univariate or Multivariate Power Transformations</h2>
      
    </div>
    
    <h2 id="examples">Examples</h2>
    <pre class="examples"><div class='input'><span class="comment"># Box Cox Method, univariate</span>
<span class="functioncall"><a href='http://www.inside-r.org/r-doc/base/summary'>summary</a></span><span class="keyword">(</span><span class="symbol">p1</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='powerTransform.html'>powerTransform</a></span><span class="keyword">(</span><span class="symbol">cycles</span> <span class="keyword">~</span> <span class="symbol">len</span> <span class="keyword">+</span> <span class="symbol">amp</span> <span class="keyword">+</span> <span class="symbol">load</span><span class="keyword">,</span> <span class="symbol">Wool</span><span class="keyword">)</span><span class="keyword">)</span></div>
<div class='output'>bcPower Transformation to Normality 

   Est.Power Std.Err. Wald Lower Bound Wald Upper Bound
Y1   -0.0592   0.0611          -0.1789           0.0606

Likelihood ratio tests about transformation parameters
                          LRT df   pval
LR test, lambda = (0)  0.9213  1 0.3371
LR test, lambda = (1) 84.0757  1 0.0000
</div>
<div class='input'>
<span class="comment"># fit linear model with transformed response:</span>
<span class="functioncall"><a href='http://www.inside-r.org/r-doc/stats/coef'>coef</a></span><span class="keyword">(</span><span class="symbol">p1</span><span class="keyword">,</span> <span class="argument">round</span><span class="argument">=</span><span class="number">TRUE</span><span class="keyword">)</span></div>
<div class='output'>Y1 
 0 
</div>
<div class='input'><span class="functioncall"><a href='http://www.inside-r.org/r-doc/base/summary'>summary</a></span><span class="keyword">(</span><span class="symbol">m1</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='http://www.inside-r.org/r-doc/stats/lm'>lm</a></span><span class="keyword">(</span><span class="functioncall"><a href='bcPower.html'>bcPower</a></span><span class="keyword">(</span><span class="symbol">cycles</span><span class="keyword">,</span> <span class="symbol">p1</span><span class="keyword">$</span><span class="symbol">roundlam</span><span class="keyword">)</span> <span class="keyword">~</span> <span class="symbol">len</span> <span class="keyword">+</span> <span class="symbol">amp</span> <span class="keyword">+</span> <span class="symbol">load</span><span class="keyword">,</span> <span class="symbol">Wool</span><span class="keyword">)</span><span class="keyword">)</span></div>
<div class='output'>
Call:
lm(formula = bcPower(cycles, p1$roundlam) ~ len + amp + load, 
    data = Wool)

Residuals:
   Min     1Q Median     3Q    Max 
-0.436 -0.113  0.008  0.116  0.268 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept) 10.551813   0.616683   17.11  1.4e-14 ***
len          0.016648   0.000875   19.02  1.4e-15 ***
amp         -0.630866   0.043752  -14.42  5.2e-13 ***
load        -0.078524   0.008750   -8.97  5.7e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 

Residual standard error: 0.186 on 23 degrees of freedom
Multiple R-squared: 0.966,	Adjusted R-squared: 0.961 
F-statistic:  217 on 3 and 23 DF,  p-value: <2e-16 

</div>
<div class='input'>
<span class="comment"># Multivariate Box Cox</span>
<span class="functioncall"><a href='http://www.inside-r.org/r-doc/base/summary'>summary</a></span><span class="keyword">(</span><span class="functioncall"><a href='powerTransform.html'>powerTransform</a></span><span class="keyword">(</span><span class="functioncall"><a href='http://www.inside-r.org/r-doc/base/cbind'>cbind</a></span><span class="keyword">(</span><span class="symbol">len</span><span class="keyword">,</span> <span class="symbol">ADT</span><span class="keyword">,</span> <span class="symbol">trks</span><span class="keyword">,</span> <span class="symbol">sigs1</span><span class="keyword">)</span> <span class="keyword">~</span> <span class="number">1</span><span class="keyword">,</span> <span class="symbol">Highway1</span><span class="keyword">)</span><span class="keyword">)</span></div>
<div class='output'>bcPower Transformations to Multinormality 

      Est.Power Std.Err. Wald Lower Bound Wald Upper Bound
len      0.1439   0.2126          -0.2728           0.5606
ADT      0.0876   0.1320          -0.1712           0.3464
trks    -0.6954   0.6170          -1.9046           0.5139
sigs1   -0.2654   0.1490          -0.5575           0.0267

Likelihood ratio tests about transformation parameters
                                LRT df   pval
LR test, lambda = (0 0 0 0)   6.014  4 0.1981
LR test, lambda = (1 1 1 1) 127.722  4 0.0000
</div>
<div class='input'>
<span class="comment"># Multivariate transformation to normality within levels of 'hwy'</span>
<span class="functioncall"><a href='http://www.inside-r.org/r-doc/base/summary'>summary</a></span><span class="keyword">(</span><span class="symbol">a3</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='powerTransform.html'>powerTransform</a></span><span class="keyword">(</span><span class="functioncall"><a href='http://www.inside-r.org/r-doc/base/cbind'>cbind</a></span><span class="keyword">(</span><span class="symbol">len</span><span class="keyword">,</span> <span class="symbol">ADT</span><span class="keyword">,</span> <span class="symbol">trks</span><span class="keyword">,</span> <span class="symbol">sigs1</span><span class="keyword">)</span> <span class="keyword">~</span> <span class="symbol">hwy</span><span class="keyword">,</span> <span class="symbol">Highway1</span><span class="keyword">)</span><span class="keyword">)</span></div>
<div class='output'>bcPower Transformations to Multinormality 

      Est.Power Std.Err. Wald Lower Bound Wald Upper Bound
len      0.1451   0.2135          -0.2733           0.5636
ADT      0.2396   0.1092           0.0255           0.4536
trks    -0.7336   0.6159          -1.9408           0.4735
sigs1   -0.2959   0.1302          -0.5511          -0.0408

Likelihood ratio tests about transformation parameters
                                      LRT df    pval
LR test, lambda = (0 0 0 0)        13.134  4 0.01064
LR test, lambda = (1 1 1 1)       140.585  4 0.00000
LR test, lambda = (0 0.33 0 -0.5)   4.794  4 0.30913
</div>
<div class='input'>
<span class="comment"># test lambda = (0 0 0 -1)</span>
<span class="functioncall"><a href='testTransform.html'>testTransform</a></span><span class="keyword">(</span><span class="symbol">a3</span><span class="keyword">,</span> <span class="functioncall"><a href='http://www.inside-r.org/r-doc/base/c'>c</a></span><span class="keyword">(</span><span class="number">0</span><span class="keyword">,</span> <span class="number">0</span><span class="keyword">,</span> <span class="number">0</span><span class="keyword">,</span> <span class="keyword">-</span><span class="number">1</span><span class="keyword">)</span><span class="keyword">)</span></div>
<div class='output'>                               LRT df      pval
LR test, lambda = (0 0 0 -1) 31.13  4 2.885e-06
</div>
<div class='input'>
<span class="comment"># save the rounded transformed values, plot them with a separate</span>
<span class="comment"># color for males and females</span>
<span class="symbol">transformedY</span> <span class="assignement">&lt;-</span> <span class="functioncall"><a href='bcPower.html'>bcPower</a></span><span class="keyword">(</span><span class="functioncall"><a href='http://www.inside-r.org/r-doc/base/with'>with</a></span><span class="keyword">(</span><span class="symbol">Highway1</span><span class="keyword">,</span> <span class="functioncall"><a href='http://www.inside-r.org/r-doc/base/cbind'>cbind</a></span><span class="keyword">(</span><span class="symbol">len</span><span class="keyword">,</span> <span class="symbol">ADT</span><span class="keyword">,</span> <span class="symbol">trks</span><span class="keyword">,</span> <span class="symbol">sigs1</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span>
                <span class="functioncall"><a href='http://www.inside-r.org/r-doc/stats/coef'>coef</a></span><span class="keyword">(</span><span class="symbol">a3</span><span class="keyword">,</span> <span class="argument">round</span><span class="argument">=</span><span class="number">TRUE</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">## &lt;strong&gt;Not run&lt;/strong&gt;: pairs(transformedY, col=as.numeric(Highway1$hwy)) </span></div></pre>
  </div>
  <div class="span4">
    <!-- <ul>
      <li>powerTransform</li><li>powerTransform.default</li><li>powerTransform.lm</li><li>powerTransform.formula</li>
    </ul>
    <ul>
      <li> regression</li>
    </ul> -->
      
    <h2>See also</h2>
    <code><a href='estimateTransform.html'>estimateTransform</a></code>, <code><a href='testTransform.html'>testTransform</a></code>,
<code><a href='http://www.inside-r.org/r-doc/stats/optim'>optim</a></code>, <code><a href='bcPower.html'>bcPower</a></code>, <code><a href='http://www.inside-r.org/r-doc/base/transform'>transform</a></code>. 
    
    <h2>Author</h2>
     Sanford Weisberg, <sandy@stat.umn.edu> 
    
  </div>
</div>